<!DOCTYPE HTML>
<html lang="ru">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>Estimate</title>
        <!-- <link rel="stylesheet" href="css/style.css"> -->
        <link rel="stylesheet" href="lib/bootstrap-5.0.2-dist/css/bootstrap.min.css">
    </head>
    <body>

        <div class="container py-3">
            <div class="mb-3">
                <h1 class="mb-0 text-uppercase">Get<span class="text-danger">Estimate</span></h1>
                <h2 class="h6 text-dark">Быстрая оценка проекта</h2>
            </div>
            
            <div id="estimate">
                <div class="row">
                    <div class="col-xl-8">
                        <div class="pt-3">
                            <div class="card bg-light mb-5">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <h3 class="mb-4 text-dark">Добавить новый пункт к оценке</h3>
                                        <div>
                                            <div 
                                            class="rounded"
                                            :class="importByPlainTextMode == false ? 'navbar-light bg-light': 'navbar-dark bg-dark'">
                                                <button 
                                                class="navbar-toggler" 
                                                title="Импорт из списка" 
                                                aria-label="Импорт из списка"
                                                @click="importByPlainTextMode = !importByPlainTextMode">
                                                    <span class="navbar-toggler-icon"></span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <template v-if="importByPlainTextMode == false">
                                        <div class="row">
                                            <div class="col-lg-5 pe-auto pe-lg-1">
                                                <div class="mb-2">
                                                    <label class="form-label"for="title">Название</label>
                                                    <input 
                                                    type="text" 
                                                    id="title" 
                                                    class="form-control w-100" 
                                                    :class="{'is-invalid': !isValid}"
                                                    value="" 
                                                    placeholder="">
                                                </div>
                                            </div>
                                            <div class="col-lg-4 px-auto px-lg-1">
                                                <div class="d-flex">
                                                    <div class="flex-grow-1 w-50 pe-1">
                                                        <div class="mb-2">
                                                            <label class="form-label"for="from">от</label>
                                                            <input type="number" id="from" class="form-control w-100" value="0" min="0" @focus="$event.target.select()">
                                                        </div>
                                                    </div>
                                                    <div class="flex-grow-1 w-50 ps-1">
                                                        <div class="mb-2">
                                                            <label class="form-label"for="to">до</label>
                                                            <input type="number" id="to" class="form-control w-100" value="0" min="0" @focus="$event.target.select()">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-3 ps-auto ps-lg-1 align-self-end">
                                                <div class="mb-2">
                                                    <button 
                                                    @click="createItem"
                                                    class="btn btn-dark w-100 text-nowrap"
                                                    >добавить</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-2">
                                            <a 
                                            class="text-danger" 
                                            href="javascript:void(0)"
                                            @click="showDescription = !showDescription"
                                            >
                                                <template v-if="showDescription" >
                                                    не добавлять описание
                                                </template>
                                                <template v-else>
                                                    добавить описание
                                                </template>
                                            </a>
                                        </div>
                                        <div :class="{'d-none': !showDescription}">
                                            <div>
                                                <label class="form-label"for="description">Описание</label>
                                                <textarea name="description" id="description" rows="6" class="form-control"></textarea>
                                            </div>
                                        </div>
                                    </template>
                                    <template v-else>
                                        <div class="mb-2">
                                            <label class="form-label"for="idImportByPlainText">Импортировать пункты оценки из списка</label>
                                            <textarea id="idImportByPlainText" class="form-control" cols="30" rows="10"></textarea>
                                            <div class="small text-muted mb-2">Вставьте пункты оценки простым текстовым списком. Каждая новая строка - новый пункт оценки.</div>
                                        </div>
                                        <button 
                                        class="btn btn-dark"
                                        @click="importByPlainText">
                                            Импорт
                                        </button>
                                    </template>

                                </div>
                            </div>
        
                            <ul v-if="items.length > 0" class="p-0">
                                <template v-for="(row, index) in items">
                                    <li 
                                    class="card mb-3" 
                                    :class="{'bg-light': row.isExclude}"
                                    id="index"
                                    >
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-lg-5 pe-auto pe-lg-1">
                                                    <div class="mb-2">
                                                        <label class="form-label":for="'title-' + index">Название</label>
                                                        <input 
                                                        type="text" 
                                                        :id="'title-' + index"
                                                        class="form-control w-100"
                                                        v-model="row.title" 
                                                        :disabled="row.isExclude == true"
                                                        placeholder="">
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 px-auto px-lg-1">
                                                    <div class="d-flex">
                
                                                        <div class="flex-grow-1 w-50 pe-1">
                                                            <div class="mb-2">
                                                                <label class="form-label":for="'from-' + index">от</label>
                                                                <input 
                                                                type="number" 
                                                                :id="'from-' + index" 
                                                                class="form-control w-100" 
                                                                v-model="row.from" 
                                                                :disabled="row.isExclude == true"
                                                                min="0"
                                                                @focus="$event.target.select()"
                                                                >
                                                            </div>
                                                        </div>
                                                        <div class="flex-grow-1 w-50 ps-1">
                                                            <div class="mb-2">
                                                                <label class="form-label":for="'to-' + index">до</label>
                                                                <input 
                                                                type="number" 
                                                                :id="'to-' + index" 
                                                                v-model="row.to"
                                                                class="form-control w-100" 
                                                                :disabled="row.isExclude == true"
                                                                min="0"
                                                                @focus="$event.target.select()">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4 ps-auto ps-lg-1 align-self-end">
                                                    <div class="mb-2">
                                                        <div class="d-flex">
                                                            <div class="flex-grow-1 w-50 pe-1">
                                                                <button 
                                                                @click="row.isExclude = !row.isExclude"
                                                            
                                                                class="btn btn-secondary w-100 px-1 text-nowrap"
                                                                >
                                                                    <template v-if="row.isExclude" >
                                                                        учитывать
                                                                    </template>
                                                                    <template v-else>
                                                                        не учитывать
                                                                    </template>
                                                                </button>
                                                            </div>
                                                            <div class="flex-grow-1 w-50 ps-1">
                                                                <button 
                                                                @click="removeItem(index)"
                                                                :disabled="row.isExclude == true"
                                                                class="btn btn-danger w-100 text-nowrap"
                                                                >удалить</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="mb-2">
                                                    <a 
                                                    class="text-danger" 
                                                    href="javascript:void(0)"
                                                    @click="row.showDescription = !row.showDescription"
                                                    >
                                                        <template v-if="row.showDescription" >
                                                            скрыть описание
                                                        </template>
                                                        <template v-else>
                                                            добавить описание
                                                        </template>
                                                    </a>
                                                </div>
                                                <div :class="{'d-none': !row.showDescription}">
                                                    <label class="form-label":for="'description-' + index">Описание</label>
                                                    <textarea 
                                                    :id="'description-' + index" 
                                                    rows="6" 
                                                    class="form-control"
                                                    v-model="row.description"
                                                    >{{row.description}}</textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </template>
                            </ul>
                        </div>
                    </div>
                    <div class="col-xl-4">
                        <div class="sticky-top py-3">
                            <div class="card bg-light">

                                <template v-if="items.length > 0">
                                    <div class="card-header ">
                                        <div class="mb-2">
                                            <strong class="text-muted">
                                                Итого по оценке: {{ sum('from') }} - {{ sum('to') }} часов
                                            </strong>
                                        </div>

                                        <div class="d-flex">
                                            <button 
                                            class="btn btn-dark me-1" 
                                            @click="copyResult">
                                                Копировать
                                            </button>
                                            <button 
                                            class="btn btn-danger ms-1" 
                                            @click="deleteResult">
                                                Очистить
                                            </button>
                                        </div>
                                        <div
                                        class="text-muted"
                                        :class="copyResultMessage == '' ? '': 'mt-2'">
                                            {{ copyResultMessage }}
                                        </div>
                                    </div>
                                </template>
                                <div class="card-body">
                                    <h4 class="card-title h6">Результат:</h4>
                                    <template v-if="items.length > 0">
                                        <ol class="mb-0 ps-3">
                                            <template v-for="(row, index) in items">
                                                <li>
                                                    <template v-if="row.isExclude">
                                                        <del>
                                                            <div>{{row.title}}</div>
                                                            <div class="text-muted" v-if="row.showDescription" >
                                                                {{row.description}}
                                                            </div>
                                                            <div>
                                                                {{row.from}} - {{row.to}} часов
                                                            </div>
                                                        </del>
                                                    </template>
                                                    <template v-else>
                                                        <div>{{row.title}}</div>
                                                        <div class="text-muted" v-if="row.showDescription" >
                                                            {{row.description}}
                                                        </div>
                                                        <div>
                                                            {{row.from}} - {{row.to}} часов
                                                        </div>
                                                    </template>

                                                    <template v-if="items.length != index+1">
                                                        <br>
                                                    </template>
                                                </li>
                                            </template>
                                        </ol>
                                    </template>
                                    <template v-else>
                                        <span class="text-muted">
                                            Пока ничего нет
                                        </span>
                                    </template>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="lib/vue/vue.min.js"></script>
        <script src="js/script.js"></script>

    </body>
</html>